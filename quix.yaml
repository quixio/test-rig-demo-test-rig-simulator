# Quix Project Descriptor
# This file describes the data pipeline and configuration of resources of a Quix Project.

metadata:
  version: 1.0

# This section describes the Deployments of the data pipeline
deployments:
  - name: mongodb
    application: mongodb
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    network:
      serviceName: mongodb
      ports:
        - port: 27017
          targetPort: 27017
    variables:
      - name: MONGO_INITDB_ROOT_USERNAME
        inputType: Secret
        description: The root username to initialize MongoDB with
        required: true
        secretKey: MONGO_USER
      - name: MONGO_INITDB_ROOT_PASSWORD
        inputType: Secret
        description: The root password to initialize MongoDB with
        required: true
        secretKey: MONGO_PASSWORD
  - name: backend
    application: backend
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    publicAccess:
      enabled: true
      urlPrefix: backend
    network:
      ports:
        - port: 80
          targetPort: 8080
    variables:
      - name: MONGO_USER
        inputType: Secret
        required: true
        secretKey: MONGO_USER
      - name: MONGO_PASSWORD
        inputType: Secret
        required: true
        secretKey: MONGO_PASSWORD
      - name: MONGO_HOST
        inputType: FreeText
        required: true
        value: mongodb
      - name: Quix__BlobStorage__Connection__Json
        inputType: Secret
        required: true
        secretKey: Quix__BlobStorage__Connection__Json
      - name: INFLUXDB_USER
        inputType: Secret
        required: true
        secretKey: INFLUXDB_USER
      - name: INFLUXDB_PASSWORD
        inputType: Secret
        required: true
        secretKey: INFLUXDB_PASSWORD
      - name: INFLUXDB_HOST
        inputType: FreeText
        required: true
        value: influxdb
      - name: INFLUXDB_PORT
        inputType: FreeText
        required: true
        value: 8086
      - name: CONFIG_API_URL
        inputType: FreeText
        required: true
        value: https://config-api-svc-quixers-testmanagerdemo-dev.az-france-0.app.quix.io
  - name: Dynamic Configuration Manager
    application: DynamicConfiguration
    version: latest
    deploymentType: Managed
    resources:
      cpu: 500
      memory: 1000
      replicas: 1
    configuration:
      topic: config-updates
      mongoHost: mongodb
      mongoPort: 27017
      mongoUser: test-manager-demo
      mongoPasswordSecret: MONGO_PASSWORD
      mongoDatabase: configuration
      mongoCollection: configurations
    plugin:
      embeddedView: true
      sidebarItem:
        show: true
        label: Config Manager
        icon: tune
        order: 1
  - name: Test Manager
    application: frontend
    version: latest
    deploymentType: Service
    resources:
      cpu: 1000
      memory: 1000
      replicas: 1
    publicAccess:
      enabled: true
      urlPrefix: frontend-7bdbce0
    network:
      ports:
        - port: 80
          targetPort: 8000
    variables:
      - name: Testmanager__Api__Url
        inputType: FreeText
        description: Test Manager API URL.
        value: https://backend-quixers-testmanagerdemo-dev.az-france-0.app.quix.io/
      - name: Testmanager__Host
        inputType: FreeText
        description: UI server host.
        required: true
        value: 0.0.0.0
      - name: Testmanager__Port
        inputType: FreeText
        description: UI server port.
        required: true
        value: 8000
      - name: Testmanager__Timezone
        inputType: FreeText
        description: Timezone to be used for the dates.
        required: true
        value: Europe/Berlin
      - name: Testmanager__Loglevel
        inputType: FreeText
        description: A log level of the UI application. Can be one of "DEBUG", "INFO", "WARNING", "ERROR".
        required: true
        value: INFO
    plugin:
      embeddedView: true
      sidebarItem:
        show: true
        label: Test Manager
        icon: tune
        order: 1
  - name: InfluxDB v1
    image: influxdb:1.11.8
    deploymentType: Service
    resources:
      cpu: 200
      memory: 500
      replicas: 1
    publicAccess:
      enabled: true
      urlPrefix: influxdb
    network:
      serviceName: influxdb
      ports:
        - port: 8086
          targetPort: 8086
        - port: 80
          targetPort: 8086
    variables:
      - name: INFLUXDB_ADMIN_USER
        inputType: Secret
        required: true
        secretKey: INFLUXDB_USER
      - name: INFLUXDB_ADMIN_PASSWORD
        inputType: Secret
        required: true
        secretKey: INFLUXDB_PASSWORD
# This section describes the Topics of the data pipeline
topics:
  - name: config-updates
